\chapter{Introduction}

With new companies jumping into the Internet of Things (IoT), 
major \emph{IT actors} investing in the development of new
products\footnote{\url{https://www.fortunebusinessinsights.com/industry-reports/internet-of-things-iot-market-100307}},
 telecoms building infrastructure for this new 
demand\footnote{\url{https://www.proximus.be/en/id_cl_iot/companies-and-public-sector/it-services/iot/internet-of-things.html}}.
IoT technology allows the gathering of data and the control of actuators via
the Internet without any human interaction.
The field has been developed during the last decade and has maintained a
consistent growth since.
Business analysts agree that we can expect to reach at least 40 billion
installed \emph{IoT} devices by
2027\footnote{\url{https://www.businessinsider.com/internet-of-things-report}}. 
We are already familiar with the traditional \emph{IoT} products
we use in our households. Those products allow to connect our light bulbs, fridge and
washing machine to the Internet.
Meanwhile, we have less knowledge on the industrial usage of \emph{IoT}, also
known as industrial IoT (IIoT). \emph{IIoT} is one of the fastest growing
segment of the market.
More and more industries are adopting IIoT to consolidate their productions
with \emph{real-time monitoring}, to organize predictive maintenance on their
assets and products to connect their supply chains, etc \ldots

All of this is enabled with the help of sensor networks, and actuators, in a
wide variety of sectors like \emph{smart farming}, \emph{smart cars},
\emph{smart cities}, \emph{energy managements}, \ldots

\paragraph{}

All these applications have in common that they count on devices that
communicate wirelessly.
% TODO Change not telecom
Telecoms created new technologies to suit this new domain that can be
classified by three different characteristics

\begin{itemize}
    \item Long or Short \emph{range}
    \item High or low \emph{data-rate}
    \item Low or high \emph{power usage} 
\end{itemize}

% From these characteristics you can only chose two according to the physical
% law. % TODO Explanation needed with the exact law reference explaining this
Figure~\ref{fig:commrangegraph} show the classification
of the existing wireless communication protocol used in the \emph{IoT} and
present it in three main categories.

\begin{itemize}
    \item \emph{Short-Range wireless} communication Short range, high data-rate
    \item \emph{Cellular} communication Long range, high data-rate
    \item \emph{Low-power wide-area network (LPWAN)} communication Long range, low power and low data-rate
\end{itemize}

\input{thesis.tex/chapters/1/fig/comparaison.tex}

This work focuses only on \emph{LoRa}, a proprietary \emph{chirp spread spectrum}
modulation technique owned by \emph{Semtech}, operating in the sub-GHz
unlicensed \emph{ISM} band. I will cover LoRa in more detail in 
Section~\ref{section:lora}.
The main characteristics of \emph{LoRa} are its low power transmission and the
fact that it can trade throughput for range by fine-tuning the PHY settings.
The long-range capabilities of the protocol caught the attention of
many people. 
Some have succeeded to obtain a record transmission distance of over 700 km with
a direct line of sight between the receiver and the
transmitter\footnote{https://www.thethingsnetwork.org/article/ground-breaking-world-record-lorawan-packet-received-at-702-km-436-miles-distance}.
However, this case is not a real-world example. The range in urban areas is of
around \emph{2 to 5 km} and around \emph{15 km} in suburban
areas~\cite{8030482}.

\emph{LoRa} is often used in conjunction with \emph{LoRaWAN}, an ALOHA 
based~\cite{loraalliance:lorawanspecification} MAC protocol deployed in a star-of-stars 
topology.
LoRaWAN is composed of wireless \emph{motes} sending messages to \emph{gateways} (GWs).
Those GWs are connected to the internet and will relay messages to central servers
as we can see in Figure~\ref{fig:startopology}.
This single-hop topology has been successful because free (as well as paid
services) LoRaWAN network to connect to already exists
\footnote{\url{https://www.thethingsnetwork.org/map}} and free private networks are
deployable in contrast to concurrent LPWAN like \emph{Sigfox} or \emph{NB-IoT}.

\input{thesis.tex/chapters/1/fig/topology.tex}

The issue with \emph{LoRaWAN}, as studied 
in~\cite{8030482}~\cite{10.1145/2988287.2989163} is its inability to scale. 
% This occurs especially 
% with dense networks, like in urban environments, where collisions can
% happen on transmission.

Channel sensing is impossible in LoRa because \emph{Channel Activity Detection}
(CAD) only detects the packet preamble. % TODO reference needed
This leads to collision when motes transmit at the same time.
On collision, the transmission has to be re-done using a back-off strategy till the
message has been correctly received or the number of trials has reached its
maximum.
This implies a higher energy consumption for the motes and more radio 
channel usage.
As the network gets denser~\cite{8030482}, the effect of collisions gets
increasingly significant with little to no packets received by gateways.

% TODO Figure from the paper about received packets ?

The \emph{duty-cycle} regulations in place for the \emph{ISM} bands on every
transmitting device (motes and gateways) is also a limiting factor 
for \emph{LoRaWAN} (\cite{8030482}).
The European ISM band has set a duty-cycle of \emph{1\%} meaning that each node 
and gateway can transmit \emph{36 sec/hour} maximum. 
% Increasing the retransmission is impossible.
% TODO This next phrase should go after
% In a high node density network, packet retransmissions quickly become impossible to
% achieve with the duty-cycle limitation.

% TODO {Add some reference to ISM regulations} 

Link quality also influences LoRaWAN's efficiency. 
Environmental factors like temperature,
humidity~\cite{evaluation_of_the_reliability_of_lora}, and the topology of the
terrain~\cite{lorajambalaya}, influence the link quality.
All these factors make network coverage typically not uniform 
as in Fig~\ref{fig:coverage}.
Motes on the border of the gateway coverage area may struggle to
achieve a full transmission. 

Gateways could restrain the deployment of LoRa networks.
They might not be deployed everywhere as they require more demanding infrastructure 
than battery-operated motes.
% TODO Weird next phrase statement about gateways.
That is the case for pipelines and tunnels~\cite{Abrardo_2019},
we would prefer to only install motes running on batteries as in linear
topology gateways are not of any use.
They can also be a single point of failure of the network, when a single
gateway covers a portion of the network. 

\input{thesis.tex/chapters/1/fig/coverage.tex}

% \begin{tikzpicture}
%     \node[draw] (Application) [abstract, rectangle]{\textbf{Application Layer}};
%     \node[draw] (MAC) [abstract, rectangle, below=0.2cm of Application, text justified]{\textbf{Media Access Control (MAC) Layer}};
%     \node[draw] (Phy) [abstract, rectangle, below=0.2cm of MAC, text justified]{\textbf{Physical (PHY) Layer}};
%     \node[draw] (Rf) [abstract, rectangle, below=0.2cm of Phy, text justified]{\textbf{Radio Frequency (RF) Layer}};
% \end{tikzpicture}

Multi-hop networks, as represented in Figure~\ref{fig:meshtopology}, can be a solution to
the LoRaWAN scaling issues~\cite{8115756}.
Participants of the network do not directly send message to gateways but
instead, pass messages to their neighboring nodes.
Using a multi-hop routing protocol increase the reliability, the range
and can adapt to topology changes in the network (because of moving or failing nodes).

Multi-hop routing protocols are de facto a strong candidates for large area monitoring 
applications where gateways may be hard and costly to deploy and where blind
spots often arise.
This solution can decrease the energy consumption of bordering nodes that
usually struggle to achieve a successful communication on non-optimal
conditions.

\paragraph{}

Work to create a multi-hop routing protocol with LoRa has already been
done~\cite{8115756, DIAS2018424, 8856256, Abrardo_2019, duong2018}, 
but some of them did not take into account the energy consumption of the nodes
with always-on radio to listen to incoming communication.
This is completely contrary to the benefit of using LPWAN networks typically
based on sleeping nodes.

A solution to this matter would be to use time-slotted channel access.
It would suppress collisions and schedule communications between nodes leaving
the nodes in a sleeping state the rest of the time.

The \emph{IEEE 802.15.4e} standard developed TSCH, a MAC
protocol to use with 802.15.4 compliant physical layer.
TSCH works particularly well where LoRaWAN shows weaknesses. 
TSCH is resilient to external interference with the use of channel hopping.
Network with high node density can work without collision issues.
It also provides high reliability communications and deterministic delays by 
keeping the nodes time-synchronized.

\paragraph{}

This thesis aims to adapt the TSCH MAC protocol for LoRa,
thus bringing a reliable, long range and low power IPv6 multi-hop
solution to the LoRa ecosystem.

Work to adapt TSCH for LoRa in~\cite{8847137} and~\cite{njomgang_2018}, has
already been done in the previous year at \emph{VUB}.
This thesis builds on the combined efforts of the previous
years to adapt \emph{TSCH} for the \emph{Zolertia RE-Mote} and the
\emph{RN2483} LoRa shield.

\paragraph{}

Chapter \ref{section:context} will give the background information and context needed to
understand the building blocks to achieve my end goal.
It will also give an overview of the related work on the subject of
LoRa multi-hop communications.
Chapter 3 gives the implementation details of writing a driver for the
RN2483 in Contiki OS and the experimentation with the driver.
Chapter 4 provides the design and implementation of bringing TSCH to LoRa as well as
the different testing I conducted.
Finally, Chapter 5 will conclude the work by summarizing it and suggesting
further research possible on the subject.
