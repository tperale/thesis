\documentclass[11pt]{report}
\usepackage{multicol,lipsum,microtype}
\usepackage[table, xcdraw,dvipsnames]{xcolor}
\usepackage[backend=biber]{biblatex}
\addbibresource{bib/main.bib}
\usepackage{vub}
\usepackage{listings}
\usepackage{lstautogobble}  % Fix relative indenting
\usepackage{xargs}
\usepackage{float}
\usepackage{tikz}
\usepackage{bytefield}
\usepackage{pgf-umlsd}
\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
\usepgfplotslibrary{statistics}
\usepgfplotslibrary{groupplots}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{acronym}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{zi4}            % Nice font
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[toc,page]{appendix}

\definecolor{bluekeywords}{rgb}{0.13, 0.13, 1}
\definecolor{greencomments}{rgb}{0, 0.5, 0}
\definecolor{redstrings}{rgb}{0.9, 0, 0}
\definecolor{graynumbers}{rgb}{0.5, 0.5, 0.5}

\usepackage[colorinlistoftodos,prependcaption,textsize=tiny]{todonotes}
\newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\change}[2][1=]{\todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
\newcommandx{\improvement}[2][1=]{\todo[linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}
\newcommandx{\thiswillnotshow}[2][1=]{\todo[disable,#1]{#2}}

% \usetikzlibrary{external}
% \tikzexternalize[prefix=tikz/]
% \usepackage[a4paper,landscape,hmargin={1cm,1cm}]{geometry}
\usepackage{tikz-timing}[2014/10/29]
\usetikztiminglibrary[rising arrows]{clockarrows}
\usetikzlibrary{fit}
\usetikzlibrary{calc}
\usetikzlibrary{quotes}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows,automata}
\usetikzlibrary{backgrounds,calc,shadings,shadows}
\usepackage{circuitikz}
\usetikzlibrary{shapes,decorations.pathreplacing}

\tikzstyle{bag} = [align=center]

\makeatletter
\pgfkeys{/pgf/.cd,
  parallelepiped offset x/.initial=2mm,
  parallelepiped offset y/.initial=2mm
}
\pgfdeclareshape{parallelepiped}
{
  \inheritsavedanchors[from=rectangle] % this is nearly a rectangle
  \inheritanchorborder[from=rectangle]
  \inheritanchor[from=rectangle]{north}
  \inheritanchor[from=rectangle]{north west}
  \inheritanchor[from=rectangle]{north east}
  \inheritanchor[from=rectangle]{center}
  \inheritanchor[from=rectangle]{west}
  \inheritanchor[from=rectangle]{east}
  \inheritanchor[from=rectangle]{mid}
  \inheritanchor[from=rectangle]{mid west}
  \inheritanchor[from=rectangle]{mid east}
  \inheritanchor[from=rectangle]{base}
  \inheritanchor[from=rectangle]{base west}
  \inheritanchor[from=rectangle]{base east}
  \inheritanchor[from=rectangle]{south}
  \inheritanchor[from=rectangle]{south west}
  \inheritanchor[from=rectangle]{south east}
  \backgroundpath{
    % store lower right in xa/ya and upper right in xb/yb
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgfmathsetlength\pgfutil@tempdima{\pgfkeysvalueof{/pgf/parallelepiped
      offset x}}
    \pgfmathsetlength\pgfutil@tempdimb{\pgfkeysvalueof{/pgf/parallelepiped
      offset y}}
    \def\ppd@offset{\pgfpoint{\pgfutil@tempdima}{\pgfutil@tempdimb}}
    \pgfpathmoveto{\pgfqpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfqpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathclose
    \pgfpathmoveto{\pgfqpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@ya}}{\ppd@offset}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@yb}}{\ppd@offset}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xa}{\pgf@yb}}{\ppd@offset}}
    \pgfpathlineto{\pgfqpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathmoveto{\pgfqpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpointadd{\pgfpoint{\pgf@xb}{\pgf@yb}}{\ppd@offset}}
  }
}
\makeatother

\definecolor{listing-background}{HTML}{F7F7F7}
\definecolor{listing-rule}{HTML}{B3B2B3}
\definecolor{listing-numbers}{HTML}{B3B2B3}
\definecolor{listing-text-color}{HTML}{000000}
\definecolor{listing-keyword}{HTML}{435489}
\definecolor{listing-keyword-2}{HTML}{1284CA} % additional keywords
\definecolor{listing-keyword-3}{HTML}{9137CB} % additional keywords
\definecolor{listing-identifier}{HTML}{435489}
\definecolor{listing-string}{HTML}{00999A}
\definecolor{listing-comment}{HTML}{8E8E8E}

\lstset{
  language         = C++,
  numbers          = left,
  xleftmargin      = 2.7em,
  framexleftmargin = 2.5em,
  backgroundcolor  = \color{listing-background},
  basicstyle       = \color{listing-text-color}\linespread{1.0}\small\ttfamily{},
  breaklines       = true,
  frame            = single,
  framesep         = 0.19em,
  rulecolor        = \color{listing-rule},
  frameround       = ffff,
  tabsize          = 4,
  numberstyle      = \color{listing-numbers},
  aboveskip        = 1.0em,
  belowskip        = 0.1em,
  abovecaptionskip = 0em,
  belowcaptionskip = 1.0em,
  keywordstyle     = {\color{listing-keyword}\bfseries},
  keywordstyle     = {[2]\color{listing-keyword-2}\bfseries},
  keywordstyle     = {[3]\color{listing-keyword-3}\bfseries\itshape},
  sensitive        = true,
  identifierstyle  = \color{listing-identifier},
  commentstyle     = \color{listing-comment},
  stringstyle      = \color{listing-string},
  showstringspaces = false,
  escapeinside     = {/*@}{@*/}, % Allow LaTeX inside these special comments
  literate         =
  {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
  {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
  {à}{{\`a}}1 {è}{{\'e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
  {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
  {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
  {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
  {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
  {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
  {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
  {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
  {€}{{\EUR}}1 {£}{{\pounds}}1 {«}{{\guillemotleft}}1
  {»}{{\guillemotright}}1 {ñ}{{\~n}}1 {Ñ}{{\~N}}1 {¿}{{?`}}1
  {…}{{\ldots}}1 {≥}{{>=}}1 {≤}{{<=}}1 {„}{{\glqq}}1 {“}{{\grqq}}1
  {”}{{''}}1
}
\lstdefinelanguage{none}{
  identifierstyle=,
  commentstyle=,
  stringstyle=,
  keywordstyle=,
}

\def\lav{lavander!90}
\def\oran{orange!30}

\tikzstyle{motes}=[draw,circle,bottom color= gray,
                  top color= white,minimum width=10pt]
\tikzstyle{gateways}=[draw,circle, left color= orange,minimum width=20pt]

\tikzset{l3 switch/.style={
    minimum width=0.75cm,
    minimum height=0.75cm,
    parallelepiped,fill=switch, draw=white,
    parallelepiped offset x=1.75mm,
    parallelepiped offset y=1.25mm,
    path picture={
      \node[fill=white,
        circle,
        minimum size=6pt,
        inner sep=0pt,
        append after command={
          \pgfextra{
            \foreach \angle in {0,45,...,360}
            \draw[-latex,fill=white] (\tikzlastnode.\angle)--++(\angle:2.25mm);
          }
        }
      ] 
       at ([xshift=-0.75mm,yshift=-0.5mm]path picture bounding box.center){};
    }
  },
  ports/.style={
    line width=0.3pt,
    top color=gray!20,
    bottom color=gray!80
  },
  rack switch/.style={
    minimum width=1.25cm,
    minimum height=0.25cm,
    parallelepiped,fill=white, draw,
    parallelepiped offset x=2mm,
    parallelepiped offset y=1.25mm,
    xscale=-1,
    path picture={
      \draw[top color=gray!5,bottom color=gray!40]
      (path picture bounding box.south west) rectangle 
      (path picture bounding box.north east);
      \coordinate (A-west) at ([xshift=-0.2cm]path picture bounding box.west);
      \coordinate (A-center) at ($(path picture bounding box.center)!0!(path
        picture bounding box.south)$);
      \foreach \x in {0.275,0.525,0.775}{
        \draw[ports]([yshift=-0.05cm]$(A-west)!\x!(A-center)$)
          rectangle +(0.1,0.05);
        \draw[ports]([yshift=-0.125cm]$(A-west)!\x!(A-center)$)
          rectangle +(0.1,0.05);
       } 
      \coordinate (A-east) at (path picture bounding box.east);
      \foreach \x in {0.085,0.21,0.335,0.455,0.635,0.755,0.875,1}{
        \draw[ports]([yshift=-0.1125cm]$(A-east)!\x!(A-center)$)
          rectangle +(0.05,0.1);       
      }
    }
  },
  server/.style={
    fill=white, draw,
    minimum width=0.35cm,
    minimum height=0.75cm,
    parallelepiped,
    parallelepiped offset x=3mm,
    parallelepiped offset y=2mm,
    xscale=-1,
    path picture={
      \draw[top color=gray!5,bottom color=gray!40]
      (path picture bounding box.south west) rectangle 
      (path picture bounding box.north east);
      \coordinate (A-center) at ($(path picture bounding box.center)!0!(path
        picture bounding box.south)$);
      \coordinate (A-west) at ([xshift=-0.575cm]path picture bounding box.west);
      \draw[ports]([yshift=0.1cm]$(A-west)!0!(A-center)$)
        rectangle +(0.2,0.065);
      \draw[ports]([yshift=0.01cm]$(A-west)!0.085!(A-center)$)
        rectangle +(0.15,0.05);
      \fill[black]([yshift=-0.35cm]$(A-west)!-0.1!(A-center)$)
        rectangle +(0.235,0.0175);
      \fill[black]([yshift=-0.385cm]$(A-west)!-0.1!(A-center)$)
        rectangle +(0.235,0.0175);
      \fill[black]([yshift=-0.42cm]$(A-west)!-0.1!(A-center)$)
        rectangle +(0.235,0.0175);
    }  
  },
}

\newcommand{\messdash}[4][0]{
  \stepcounter{seqlevel}
  \path
  (#2)+(0,-\theseqlevel*\unitfactor-0.7*\unitfactor) node (mess from) {};
  \addtocounter{seqlevel}{#1}
  \path
  (#4)+(0,-\theseqlevel*\unitfactor-0.7*\unitfactor) node (mess to) {};
  \draw[->,>=angle 60, dashed] (mess from) -- (mess to) node[midway, above]
  {#3};

  \node (#3 from) at (mess from) {};
  \node (#3 to) at (mess to) {};
}


\title{Enabling IPv6 multi-hop networks with Time Slotted Channel Hopping and long range LoRA radios}
\author{Perale Thomas}
\faculty{Science and Bio-Engineering Sciences}
\promotors{Promotors: Prof. Dr. Ir. Kris Steenhaut, Prof. Dr. Eliza
Gonzalez Boix\newline Supervisor: Roald Van Glabbeek}
\pretitle{Master thesis submitted in partial fulfilment of the requirements for the degree of Master of Science in Applied Sciences and Engineering: Computer Science}
\date{2019 - 2020}

\def\triangleH{27.7mm}

\begin{document}
\maketitle

\pagenumbering{roman}


\clearpage
\vspace*{\fill}
\begin{center}
\begin{minipage}{.6\textwidth}
This master's thesis came about (in part) during the period in which higher
education was subjected to  a  lockdown  and  protective  measures  to  prevent
the  spread  of  the  COVID-19  virus.  The  process  of formatting, data
collection, the research method and/or other scientific work the thesis
involved could therefore not always be carried out in the usual manner. The
reader should bear this context in mind when reading this Master's thesis, and
also in the event that some conclusions are taken on board.
\end{minipage}
\end{center}
\vfill % equivalent to \vspace{\fill}
\clearpage

\newpage

\section*{Abstract}

% LoRa and its inherent MAC protocol LoRaWAN is known to scale badly and suffer
% from range issue.
% Research has shown that in large LoRaWAN networks collisions often occur which
% makes it impossible to achieve a complete transmission.
% Also gateways are not always in the motes range.
% One of the solution to solve these problems would be to use a multi-hop routing
% protocol with LoRa to increase the realiability and range of the network.
% Because little research has been done on LoRa multi-hop network,
% this thesis has for objective to adapt 6TiSCH network stack to work with LoRa 
% and thus bringing realiable and low power multi-hop communication for LoRa.

% In order to do that, I will implement a radio driver for the RN2483 LoRa radio
% module and adapt the current implementation of TSCH in Contiki to work with
% this specific radio module.
% Based on my work I will show my implementation can correctly work with standard
% routing protocols like RPL or Orchestra.

% The result shows it's possible to have a reliable multi-hop network using LoRa 
% and TSCH but will still require more testing to proove its energy efficiency.

\newpage

\section*{Acknowledgement}

I would first like to thank my supervisor Roald Van Glabbeek that introduced me
to the subject and allowed me to catch up with the missing knowledge I had at
the start of the year.
I am especially grateful for his availability and helpfullness that gave me the
right tools to achieve this work.
I would also like to thanks my promotors Prof. Dr. Ir. Kris Steehaut and Prof.
Dr. Eliza Gonzalez Boix that provided me with this great subject and helped me 
during the year.

% I would also like to thanks the Urlab hackerspace that sparked my interest for
% embedded devices and low power communication protocols over the years.

\newpage

\tableofcontents

\newpage

\listoffigures

\newpage

\section*{List of acronyms}

\input{acro_list}

\newpage

\pagenumbering{arabic}

\input{thesis.tex/chapters/1/index.tex}

\input{thesis.tex/chapters/context/index.tex}

\input{thesis.tex/chapters/driver/index.tex}

\input{thesis.tex/chapters/tsch/index.tex}

\chapter{Conclusion and further work\label{section:conclusion}}

The goal of the thesis was to adapt TSCH to work with LoRa to achieve power
efficient and reliable multihop networking with LoRa on Contiki OS with the 
RN2483 LoRa module.

\paragraph{}

My work was divided into two parts. 
In the first part, I successfully implemented a working driver for the RN2483
module. 
Section~\ref{section:pingpong} detail how I ran a ping pong
example based on that driver to prove the driver is fully working with the
rest of the applications.

The second part should have been on paper limited to the adaptations of the
timing variable of the TSCH protocol to work with LoRa.
In the end, the long delay induced by LoRa communication turned out to 
not work seamlessly with Contiki. 
The second part of my work became a bug hunt with the TSCH implementation 
I detailed in section~\ref{section:timingparameters}.
The TSCH parameters I used were used as a mean to achieve a working version of
the protocol rather than getting the optimal version of TSCH with LoRa.
I finally managed to make LoRa work with TSCH in section~\ref{section:tschtesting} by
demonstrating my work integrates into the 6TiSCH networking stack.
I addressed my concerns about the reliability of my implementation
because of the drift issues caused by the hardware in~\ref{section:driftissues}.

\paragraph{}

In his last year's master thesis, Roald Van Glabbeek suggested further research
should conduct a power analysis on the RN2483 module.
I responded to this statement in~\ref{section:energyconsumption} about how
achieving a low power network with TSCH and this module is impossible because
of the design of the module.

The good news is I'm confident that achieving a low power multi-hop network with 
a radio module like the SX1272 is possible.
This thesis explained what it takes to adapt TSCH for a new LoRa radio
module and the possible re-implementation of this project on a new radio module 
will then be facilitated. 

This would create a stable testing device that would allow us to measure meaningful 
data for the analysis of power consumption and reliability of the network.
The following tasks could be conducted

\begin{itemize}
  \item Determining the optimal TSCH parameters for LoRa. 
  \item Finding the optimal period between EB packets to keep a balance between
    low power usage and maintaining synchronization.
  \item Compare how it performs in regards to LoRaWAN. Is the TSCH overhead
    worth it ?
  \item The network capacity and transmission delay.
\end{itemize}

\paragraph{}

The ideal implementation would adapt its SF depending on the distance
between two hops.
In my implementation even though the different SF are supported, only operates
on a single SF at the time. 
We miss a lot of LoRa features with the single SF, supporting multiple SF at
the same time would increase the network throughput and increase the
transmission range for nodes with low reception.
The literature does not talk about using adaptive SF in a multi-hops
network except for~\cite{8115756} that could give us indications on the future
work on the subject.

\paragraph{}

Related work reinvented the wheel by implementing their multi-hop solution
using their own MAC protocol on top of LoRa.
Using TSCH, an already well studied MAC protocol,
and prooving it can work with the existing multi-hop routing solutions,
represents a step forward in the LoRa multi-hop networking research.
Reliable implementation, performance, and energy consumption tests, as well as 
using every SF to use the full LoRa capacity is the future challenge of the
subject.

\newpage

\printbibliography

\newpage

\begin{appendices}
\input{thesis.tex/chapters/appendix/index.tex}
\end{appendices}

\end{document}

